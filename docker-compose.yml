services:
  mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: mcp-docker-demo
    # Keep stdin open for Stdio transport
    stdin_open: true
    # Disable TTY to avoid interfering with the protocol
    tty: false
    # Mount the current directory for easier development (optional)
    volumes:
      - .:/app

  mcp-client:
    build:
      context: client
      dockerfile: Dockerfile
    # Mount the Docker socket to allow spawning sibling containers
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    # Ensure the server image is built first
    depends_on:
      - mcp-server
